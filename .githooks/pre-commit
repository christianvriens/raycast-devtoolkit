#!/usr/bin/env bash
set -euo pipefail

echo "Running test-suite before commit... (enable hooks with: chmod +x scripts/enable-local-githooks.sh && ./scripts/enable-local-githooks.sh)"

# Prefer using the project launcher which creates an isolated venv
if [ -x "./python-tools/run.sh" ]; then
  ./python-tools/run.sh test || { echo "Tests failed. Aborting commit."; exit 1; }
else
  # Fallback: try pytest directly
  if command -v pytest >/dev/null 2>&1; then
    pytest -q python-tools/tests || { echo "Tests failed. Aborting commit."; exit 1; }
  else
    echo "ERROR: No test runner available (no ./python-tools/run.sh and pytest not installed)." >&2
    echo "Please run tests manually before committing." >&2
    exit 1
  fi
fi

exit 0
